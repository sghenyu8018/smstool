# 更新日志

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 新增
- 添加短信签名成功率查询功能 (`query_sms_success_rate`)
  - 支持查询指定PID的短信签名成功率
  - 支持多个时间范围：当天、本周、一周、上周、30天
  - 返回详细的统计数据，包括"客户签名视角"表格的所有字段

### 改进
- 短信签名查询支持多行工单号提取
- 根据修改时间自动选择最新的工单号
- 支持从环境变量读取PID和签名名称
- 成功率查询优化：直接在SLS iframe (Frame 3)中操作，提高效率和稳定性
- 成功率查询时间选择器改为30天
- 添加详细的元素打印功能，便于调试和判断查询条件
- **成功率查询功能增强**：
  - 支持多个时间范围选择（当天、本周、一周、上周、30天）
  - **精确定位"客户签名视角 -剔除重试过程"表格**，确保提取正确的数据
  - 完整提取"客户签名视角"表格数据，包括：
    - signname（签名名称）
    - 短信类型
    - 提交量
    - 回执量
    - 回执成功率
    - 回执率、十秒回执率、三十秒回执率、六十秒回执率等完整统计信息
  - 改进数据提取逻辑，优先从 `table-m__split-container` 容器中提取数据

### 重构
- **代码模块化**: 将查询函数拆分到独立的工具模块
  - 创建 `utils/sms_query_tools.py` 模块，包含所有查询核心功能
  - 创建 `utils/__init__.py`，提供统一的导入接口
  - 简化 `sms_signature_query.py`，仅保留导入、扩展基类和主入口
  - 提高代码模块化和可维护性
  - 保持向后兼容性

### 文档
- 添加 `.cursorrules` 文件，定义代码提交规范
  - 要求提交前必须更新 CHANGELOG.md 和 README.md
  - 提供提交信息格式指南
  - 包含文档更新示例和检查清单

## [1.0.0] - 2024

### 新增
- 初始版本发布
- 短信签名查询功能 (`query_sms_signature`)
  - 支持根据客户PID和签名名称查询工单号
  - 支持多行工单号查询，自动选择最新的
- SSO自动登录功能
- 会话管理功能（24小时有效期）
- 环境变量配置支持
- 完整的项目文档

### 技术栈
- Playwright - 浏览器自动化
- Python 3.8+ - 编程语言
- asyncio - 异步编程支持
